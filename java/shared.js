Flavors.Layout.Shared={};
(function(){var c=Flavors.Global.namespace("Flavors.Layout.Shared"),f=Flavors.Logger.getLogger(c.__name__),j=false,g=null;c.contentContext=$("#layout-content-accounts");c.navContext=$("#layout-about-navs");c.updateAnchor=function(a,b){var e=a.panel;e.element.attr("data-anchor",b);e.serviceAnchor=b;g===e&&$.address.value(e.serviceAnchor);$("[data-account-id="+a.serviceId+"]",c.navContext.add("#layout-about-description")).attr("data-anchor",b)};c.updateAnchors=function(a){var b=[];$.each(accounts,function(e,
d){var h=d.serviceId,i=a[h];if(i!==e&&a.hasOwnProperty(h)){b.push({account:d,newAnchor:i});d.serviceAnchor=i;delete accounts[e]}});$.each(b,function(e,d){accounts[d.newAnchor]=d.account;c.updateAnchor(d.account,d.newAnchor)})};c.preInit=function(){f("preInit")};c.init=function(){f("init");c.initRegisterPanels();c.initPermalinkNavigation();f("Initialized")};c.reorderList=function(a,b,e){var d=$(a),h={};d.find("li").each(function(){h[e(this)]=this;$(this).remove()});$.each(b,function(i,l){f("reorder item...");
d.append(h[l])})};var k=window.layout_name=="slider"?"#layout-about-navs .layout-about-item-label":".layout-about-nav-label, .layout-about-nav-icon";c.initNavigation=function(){f("initNavigation");$(document).on("click",k,function(a){f("nav click handler");a.preventDefault();if(!j){var b=$(this).hasClass("about_text"),e=$(this);$(this).trigger("service-nav-click",a);$(this).closest("li").each(function(){var d=this.getAttribute("data-anchor");if(!(d&&d=="0-contact"))if(d){f("serviceAnchor="+d);if(d=
c.preparePanel(d))if(b)window.layout_name!="divided"?c.closeAllServices():c.switchToFirstService();else{c.transitionToPanel(d);c.setNavState(e)}}})}})};c.setNavState=function(a){f("setNavState");try{$(k).each(function(){$(this).removeClass("about_text").addClass("about_links")});a.removeClass("about_links").addClass("about_text")}catch(b){}};c.closeAllServices=function(a){f("closeAllServices");a&&a.preventDefault();if(g){$(g.element).hide();$("#layout-content-accounts").hide();g=null}$.address.value("_");
$(k).each(function(){$(this).removeClass("about_text").addClass("about_links")});$(window).trigger("service-nav-close")};c.transitionToPanel=function(a){f("transitionToPanel() serviceAnchor="+a.serviceAnchor);j=true;var b=function(){$(a.element).show();$("#layout-content-accounts").show();$.address.value(a.serviceAnchor);$(".content-map-embed").each(function(){$(this).googleMap($(this).attr("rel"))});$(".content-custom-map-embed").each(function(){$(this).googleMapCustom()});Flavors.Page.fixVideoEmbeds();
var e=$(a.element).find(".layout-content-nav-dropdown-menu-item:first");e.length>0?e.trigger("click",true):$(window).trigger("service-nav-load-complete");g=a;j=false;$(window).trigger("service-nav-open")};g?$("#layout-content-accounts").hide(0,function(){$(g.element).hide();g=a;b()}):b()};c.getFirstServiceAnchor=function(){return $("#layout-about-navs li:not(#layout-about-nav-0-contact):first").data("anchor")};c.switchToFirstService=function(){setTimeout(function(){c.switchToService(c.getFirstServiceAnchor())},
100)};c.switchToService=function(a){f("switchToService() serviceAnchor="+a);if(a==="_")if(window.layout_name=="divided")c.switchToFirstService();else window.layout_name=="slider"?$(".layout-content-button-back").click():c.closeAllServices();else{var b=c.preparePanel(a);b&&c.transitionToPanel(b);c.setNavState($("[data-anchor="+a+"] .layout-about-nav-label",c.navContext))}};c.initRegisterPanels=function(){f("initRegisterPanels");for(var a in accounts)c.registerPanel(a)};c.registerPanel=function(a){f("registerPanel serviceAnchor="+
a);accounts[a].panel=new Flavors.Panel(a);accounts[a].panel.initialized=false};c.initPermalinkNavigation=function(){f("initPermalinkNavigation");$.address.strict(false);$.address.externalChange(function(a){f("$.address.externalChange()");if(a.value!="/"){var b=a.value;f("serviceAnchor="+b);if(b.length>0&accounts.hasOwnProperty(b))c.switchToService(b);else if(window.service_onload||window.layout_name=="divided")c.switchToFirstService();else if(window.layout_name=="slider"&&b=="_")$(".layout-content-button-back").click();
else if(!accounts.hasOwnProperty(b)&a.value!=="")return false}})};c.initSubNavigation=function(a){f("initSubNavigation");$("body").on("click tap",function(b){b=$(b.target);!b.hasClass("layout-content-nav-dropdown")&&!b.hasClass("layout-content-nav-dropdown-text")&&!b.hasClass("layout-content-nav-dropdown-menu")&&$(".layout-content-nav-dropdown-menu").hide()});if(a.find(".layout-content-nav-dropdown-menu-item").length==1){a.find(".layout-content-nav-dropdown").addClass("layout-content-nav-dropdown-disabled");
a.find(".layout-content-nav-dropdown-text").removeClass("content_links")}else{a.find(".layout-content-nav-dropdown").removeClass("layout-content-nav-dropdown-disabled");a.find(".layout-content-nav-dropdown-text").addClass("content_links")}a.on("tap",".layout-content-nav-dropdown",function(){$(this).find(".layout-content-nav-dropdown-menu").slideDown(200)});a.on("click tap",".content_links_arrow_down",function(){$(this).parent(".layout-content-nav-dropdown").find(".layout-content-nav-dropdown-menu").slideDown(200)});
a.on("click tap",".layout-content-nav-dropdown-menu-item",function(b,e){b.preventDefault();if(e||!$(this).hasClass("layout-content-nav-dropdown-menu-item-selected")){var d=$(this).attr("data-nav-id");a.find(".layout-content-nav-dropdown-menu-item").removeClass("layout-content-nav-dropdown-menu-item-selected").removeClass("content_text");$(this).addClass("layout-content-nav-dropdown-menu-item-selected").addClass("content_text");a.find(".layout-content-nav-dropdown-text").text($(this).text());a.find(".layout-content-panels:visible").length>
0?a.find(".layout-content-panels:visible").hide(0,function(){c.showSubPanel(a,d)}):c.showSubPanel(a,d)}})};c.showSubPanel=function(a,b,e){f("showSubPanel");if(e===undefined)e=true;var d=a.find(".layout-content-subaccount-"+b);window.layout_name.indexOf("columns")>-1&&d.parents(".layout-content-account").find(".layout-content-pagination").remove();$(window).trigger("onShowPanel",[a,b]);if(d.length==0)$(window).trigger("service-nav-load-complete");else{var h=12/parseInt(a.find(".layout-content-subaccount-"+
b).attr("data-columns"));d.parent().find(".layout-content-nav").removeClass("layout-invisible");d.addClass("layout-invisible").show().isotope({transitionDuration:0,itemSelector:".layout-content-panel",filter:":not(.layout-invisible, .galleria)",layoutMode:"masonry",itemPositionDataEnabled:true,transformsEnabled:false,hiddenStyle:{opacity:0},visibleStyle:{opacity:1},sortBy:"original-order"});setTimeout(function(){if(d.hasClass("content-blog"))d.loadDeferredImages({showLoader:e});else{var i=c.getPageSteps(d,
h);d.loadDeferredImages({showLoader:e,loadCount:i})}c.buildPanelFeatures(a,d,h)},0)}};c.buildPanelFeatures=function(a,b,e){f("buildPanelFeatures");if(e){c.setPagination(b,e);b.find(".content-map-embed").each(function(){$(this).googleMap($(this).attr("rel"))});b.find(".content-custom-map-embed").each(function(){$(this).googleMapCustom()});b.hasClass("content-blog")&&b.blogEmbedResize()}else{b.isotope("once","layoutComplete",function(){Flavors.Global.fireRelayout($(this.element));var d=setInterval(function(){if(smReady){clearInterval(d);
setTimeout(function(){b.hasClass("content-audio")&&threeSixtyPlayer.init(b);b.hasClass("content-audio-set")&&threeSixtyPlayer.init(b);b.isotope("layout")},1E3)}},100);c.initPhotoGalleria(b);c.initVideoGalleria(b);setTimeout(function(){$(window).trigger("service-nav-load-complete");$(".layout-content-button-back").show()},1);typeof Flavors.Layout.initScrollPanes=="function"&&setTimeout(function(){Flavors.Layout.reinitializeScrollpanes(b)},1)});b.isotope("layout")}$(".content-blog-body img").each(function(){var d=
$(this);if(d.attr("src")){d.attr("src").indexOf("feedburner.com/~r/TypePadNews")>-1&&d.hide();if(d.attr("src").indexOf("wordpress.com/1.0/comments")>-1||d.attr("src").indexOf("wordpress.com/1.0/tags")>-1||d.attr("src").indexOf("wordpress.com/1.0/categories")>-1||d.attr("src").indexOf("wordpress.com/1.0/delicious")>-1||d.attr("src").indexOf("wordpress.com/1.0/facebook")>-1||d.attr("src").indexOf("wordpress.com/1.0/twitter")>-1||d.attr("src").indexOf("wordpress.com/1.0/stumble")>-1||d.attr("src").indexOf("wordpress.com/1.0/digg")>
-1||d.attr("src").indexOf("stats.wordpress.com")>-1||d.attr("src").indexOf("wordpress.com/1.0/reddit")>-1)d.hide()}else d.hide()});a&&a.is(".layout-content-account-type-formspring")&&a.find("form").ajaxForm({url:c.getFormspringURL(),dataType:"json",success:function(d){if(d&&d.success){a.find(".content-button").val("Your question has been sent.");a.find("textarea").val("")}else a.find(".content-button").val("An error occured, try again.");setTimeout(function(){a.find(".content-button").val("Ask a question").removeAttr("disabled")},
5E3)},error:function(){a.find(".content-button").val("An error occured, try again.");setTimeout(function(){a.find(".content-button").val("Ask a question").removeAttr("disabled")},5E3)},beforeSubmit:function(){if($.trim(a.find("textarea").val())==""){a.find(".content-button").val("Please enter a question.").attr("disabled","disabled");setTimeout(function(){a.find(".content-button").val("Ask a question").removeAttr("disabled")},5E3);return false}a.find(".content-button").val("Sending to Formspring...").attr("disabled",
"disabled")}})};c.getPageSteps=function(a,b){f("getPageSteps");return window.layout_name.indexOf("columns")>-1?a.hasClass("content-blog")?b:b<3?6*b:3*b:12*b};c.setPagination=function(a,b){f("setPagination");a.parent().find(".layout-content-pagination").remove();b=c.getPageSteps(a,b);var e=window.layout_name.indexOf("columns")>-1?false:true;a.easyPaginate({step:b,numeric:e,controls:"layout-content-pagination",callback:function(){if(window.layout_name.indexOf("columns")==-1)$(window).scrollTo(0,0);
else{var d=a.parents(".jspScrollable").data("jsp");d!==undefined&&d.scrollTo(0,0)}}})};c.initPhotoGalleria=function(a){f("initPhotoGalleria");if(a.hasClass("content-panel-photo-large"))if(a.find(".galleria:first").data("galleria")===undefined){a.find(".galleria:first").galleria({imagePan:false,imageCrop:false,fullscreenCrop:false,maxScaleRatio:1,dataSelector:"span",popupLinks:true,dataConfig:function(b){if($.trim($(b).attr("data-large"))==""&&$.trim($(b).attr("data-big"))=="")var e=$(b).attr("data-src"),
d=$(b).attr("data-src");else if($.trim($(b).attr("data-big"))==""){e=$(b).attr("data-large");d=$(b).attr("data-large")}else{e=$.trim($(b).attr("data-large"))==""?$(b).attr("data-big"):$(b).attr("data-large");d=$(b).attr("data-big")}return{thumb:$(b).attr("data-src"),image:e,big:d,title:$(b).attr("data-title"),description:$(b).attr("data-alt"),link:$(b).attr("data-link")}},extend:function(){this.bind("fullscreen_enter",function(){a.find(".galleria:first").removeClass("layout-invisible")});this.bind("fullscreen_exit",
function(){a.find(".galleria:first").addClass("layout-invisible")})}});a.on("tap",".content-gallery-fullscreen",function(b){b.preventDefault();var e=$(this),d=$(this).parents(".layout-content-panels").find(".galleria:first").data("galleria");d.enterFullscreen(function(){setTimeout(function(){d.show(parseInt(e.attr("data-index")));d.$("image").css("opacity","1")},0)})});a.on("tap",".content-gallery-zoom-js",function(b){b.preventDefault();b=$(this);$(this).parents(".layout-content-panels").find(".galleria:first").data("galleria").openLightbox(parseInt(b.attr("data-index")))})}};
c.initVideoGalleria=function(a){f("initVideoGalleria");if(a.hasClass("content-panel-video-large"))if(a.find(".galleria:first").data("galleria")===undefined){a.find(".galleria:first").galleria({imagePan:false,imageCrop:false,fullscreenCrop:false,maxScaleRatio:1,dataSelector:"span",popupLinks:true,preload:0,queue:false,dataConfig:function(b){return{thumb:$(b).attr("data-src"),image:$(b).attr("data-large"),imageWidth:$(b).attr("data-large-width"),imageHeight:$(b).attr("data-large-height"),big:$(b).attr("data-large"),
embed:$(b).attr("data-embed"),title:$(b).attr("data-title"),description:$(b).attr("data-alt")}},extend:function(){this.bind("fullscreen_enter",function(){a.find(".galleria:first").removeClass("layout-invisible")});this.bind("fullscreen_exit",function(){a.find(".galleria:first").addClass("layout-invisible")})}});a.on("tap",".content-gallery-fullscreen",function(b){b.preventDefault();var e=$(this),d=$(this).parents(".layout-content-panels").find(".galleria:first").data("galleria");d.enterFullscreen(function(){setTimeout(function(){d.show(parseInt(e.attr("data-index")));
d.$("image").css("opacity","1")},0)})});a.on("tap",".content-gallery-thumb img, .content-gallery-play",function(b){b.preventDefault();b=$(this);$(this).parents(".layout-content-panels").find(".galleria:first").data("galleria").openLightbox(parseInt(b.parents(".content-gallery-thumb").find(".content-gallery-play").attr("data-index")))})}};c.preparePanel=function(a){f("preparePanel() serviceAnchor="+a);if(a in accounts){a=accounts[a].panel;if(a.initialized)return a;var b=$(a.element);b.find(".layout-content-panels").length>
1&&b.find(".layout-content-panels").hide();c.initSubNavigation(b,a);a.initialized=true;Flavors.Global.setFuzzyDate();return a}};c.getFormspringURL=function(){if(DOMAIN.length==0||window.location.href.indexOf(DOMAIN)==-1)var a="/"+USERNAME+"/formspring/profile_ask";else{a=window.location.href;if(a.indexOf("?")>-1)a=a.slice(0,a.indexOf("?"));a=a.replace(new RegExp(/#.*$/),"").replace(new RegExp(/\/$/),"")+"/"+USERNAME+"/formspring/profile_ask"}return a};$windowElm=$(window);$aboutElm=$("#layout-about");
c.aboutChangePosition=function(){f("aboutChangePosition");$windowElm.height()<$aboutElm.outerHeight()?$aboutElm.css("position","absolute"):$aboutElm.css("position","fixed")};c.narrowScreen=function(a){f("narrowScreen");$windowElm.width()<a?$("body").addClass("layout-narrowscreen"):$("body").removeClass("layout-narrowscreen")};c.addService=function(a,b){f("addService");$("#layout-about-navs").removeClass("layout-hidden");if(!b){var e=$($.LI({id:"layout-about-nav-"+a.anchor,"class":"layout-about-nav-"+
a.id+" layout-about-item"},$.SPAN({"class":"layout-about-item-label about_background"},$.SPAN({"class":"layout-about-nav-label"},a.title))));e.attr("data-anchor",a.anchor).attr("data-account-id",a.id);$("#layout-about-navs").append(e);window.hide_service_icon_labels&&$(".layout-about-nav-"+a.id+" .layout-about-nav-label").hide();$("#layout-about-nav-0-contact").remove().appendTo("#layout-about-navs")}Flavors.Layout.aboutChangePosition();Flavors.Page.setUserpageImageColors("about_background");e=$($.LI({"class":"layout-content-account-type-"+
a.token+" layout-content-account layout-content-account-id-"+a.id,id:"layout-content-account-anchor-"+a.anchor}));b&&e.addClass("content_background");e.attr("data-anchor",a.anchor).attr("data-account-id",a.id).html(a.html).appendTo($("#layout-content-accounts"));window.accounts[a.anchor]={serviceId:String(a.id),type:"type"in a?a.type:a.token};c.registerPanel(a.anchor);b?$(e).find(".layout-content-panels").wrap('<div class="layout-content-mask" />'):c.switchToService(a.anchor);Flavors.Page.initExternalLinksNewWindow()};
c.removeService=function(a){f("removeService");$(".layout-content-account-id-"+a+", .layout-about-nav-"+a).fadeOut(250,function(){$(this).remove();$("#layout-about-nav-0-contact").remove().appendTo("#layout-about-navs")});$servicePanel=$(".layout-content-account-id-"+a);$servicePanel.remove();c.closeAllServices();Flavors.Layout.aboutChangePosition()};c.replaceService=function(a){f("replaceService");$("[data-account-id="+a.id+"]",c.contentContext).html(a.html);Flavors.Page.initExternalLinksNewWindow();
c.registerPanel(a.anchor);c.switchToService(a.anchor)};c.reorderServices=function(a){f("reorderServices");$("#layout-about-navs").reorderList(a,function(b){return parseInt($(b).attr("class").match(/\d+/)[0])},function(){$("#layout-about-nav-0-contact").remove().appendTo("#layout-about-navs")})};c.addLink=function(a){f("addLink");$("#layout-about-links").append($.LI({"class":"layout-about-item",id:"layout-about-link-"+a.id},$.A({href:a.url,rel:"nofollow","class":"layout-about-item-label about_background",
title:a.title},a.title)));Flavors.Page.initExternalLinksNewWindow();Flavors.Layout.aboutChangePosition()};c.reorderLinks=function(a){f("reorderLinks");c.reorderList("#layout-about-links",a,function(b){return parseInt($(b).attr("id").match(/\d+/)[0])})}})();